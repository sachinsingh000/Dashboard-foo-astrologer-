import 'package:flutter/material.dart';import 'package:flutter/services.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';import '../../../widgets/custom_icon_widget.dart';/// Video controls overlay widget for the video call screen/// Provides camera, microphone, and call control functionalityclass VideoControlsOverlay extends StatefulWidget {  final bool isVisible;  final bool isMuted;  final bool isCameraOn;  final bool isSpeakerOn;  final bool isFrontCamera;  final VoidCallback onToggleMute;  final VoidCallback onToggleCamera;  final VoidCallback onToggleSpeaker;  final VoidCallback onFlipCamera;  final VoidCallback onEndCall;  final VoidCallback onToggleVisibility;  const VideoControlsOverlay({    super.key,    required this.isVisible,    required this.isMuted,    required this.isCameraOn,    required this.isSpeakerOn,    required this.isFrontCamera,    required this.onToggleMute,    required this.onToggleCamera,    required this.onToggleSpeaker,    required this.onFlipCamera,    required this.onEndCall,    required this.onToggleVisibility,  });  @override  State<VideoControlsOverlay> createState() => _VideoControlsOverlayState();}class _VideoControlsOverlayState extends State<VideoControlsOverlay>    with SingleTickerProviderStateMixin {  late AnimationController _animationController;  late Animation<double> _fadeAnimation;  @override  void initState() {    super.initState();    _animationController = AnimationController(      duration: const Duration(milliseconds: 300),      vsync: this,    );    _fadeAnimation = Tween<double>(      begin: 0.0,      end: 1.0,    ).animate(CurvedAnimation(      parent: _animationController,      curve: Curves.easeInOut,    ));    if (widget.isVisible) {      _animationController.forward();    }  }  @override  void didUpdateWidget(VideoControlsOverlay oldWidget) {    super.didUpdateWidget(oldWidget);    if (widget.isVisible != oldWidget.isVisible) {      if (widget.isVisible) {        _animationController.forward();      } else {        _animationController.reverse();      }    }  }  @override  void dispose() {    _animationController.dispose();    super.dispose();  }  void _handleControlTap(VoidCallback action) {    HapticFeedback.lightImpact();    action();  }  @override  Widget build(BuildContext context) {    return GestureDetector(      onTap: widget.onToggleVisibility,      child: AnimatedBuilder(        animation: _fadeAnimation,        builder: (context, child) {          return Opacity(            opacity: _fadeAnimation.value,            child: Container(              width: double.infinity,              height: double.infinity,              color: Colors.black.withValues(alpha: 0.3),              child: Stack(                children: [                  // Top controls                  Positioned(                    top: 8.h,                    left: 4.w,                    right: 4.w,                    child: _buildTopControls(context),                  ),                  // Bottom controls                  Positioned(                    bottom: 12.h,                    left: 4.w,                    right: 4.w,                    child: _buildBottomControls(context),                  ),                ],              ),            ),          );        },      ),    );  }  Widget _buildTopControls(BuildContext context) {    return Container(      padding: EdgeInsets.symmetric(horizontal: 4.w, vertical: 2.h),      decoration: BoxDecoration(        color: Colors.black.withValues(alpha: 0.5),        borderRadius: BorderRadius.circular(12),      ),      child: Row(        children: [          GestureDetector(            onTap: () => _handleControlTap(widget.onFlipCamera),            child: Container(              padding: EdgeInsets.all(2.w),              decoration: BoxDecoration(                color: Colors.white.withValues(alpha: 0.2),                borderRadius: BorderRadius.circular(8),              ),              child: CustomIconWidget(                iconName: 'flip_camera_ios',                color: Colors.white,                size: 20.sp,              ),            ),          ),          const Spacer(),          Text(            'Tap to hide controls',            style: Theme.of(context).textTheme.bodySmall?.copyWith(              color: Colors.white,              fontSize: 12.sp,            ),          ),        ],      ),    );  }  Widget _buildBottomControls(BuildContext context) {    return Container(      padding: EdgeInsets.symmetric(horizontal: 6.w, vertical: 3.h),      decoration: BoxDecoration(        color: Colors.black.withValues(alpha: 0.7),        borderRadius: BorderRadius.circular(16),      ),      child: Row(        mainAxisAlignment: MainAxisAlignment.spaceEvenly,        children: [          _buildControlButton(            icon: widget.isMuted ? 'mic_off' : 'mic',            isActive: !widget.isMuted,            onTap: () => _handleControlTap(widget.onToggleMute),          ),          _buildControlButton(            icon: widget.isCameraOn ? 'videocam' : 'videocam_off',            isActive: widget.isCameraOn,            onTap: () => _handleControlTap(widget.onToggleCamera),          ),          _buildControlButton(            icon: widget.isSpeakerOn ? 'volume_up' : 'volume_down',            isActive: widget.isSpeakerOn,            onTap: () => _handleControlTap(widget.onToggleSpeaker),          ),          _buildEndCallButton(context),        ],      ),    );  }  Widget _buildControlButton({    required String icon,    required bool isActive,    required VoidCallback onTap,  }) {    return GestureDetector(      onTap: onTap,      child: Container(        width: 12.w,        height: 12.w,        decoration: BoxDecoration(          color: isActive              ? Colors.white.withValues(alpha: 0.2)              : Colors.red.withValues(alpha: 0.3),          shape: BoxShape.circle,          border: Border.all(            color: isActive ? Colors.white : Colors.red,            width: 1,          ),        ),        child: Center(          child: CustomIconWidget(            iconName: icon,            color: isActive ? Colors.white : Colors.red,            size: 20.sp,          ),        ),      ),    );  }  Widget _buildEndCallButton(BuildContext context) {    return GestureDetector(      onTap: () => _showEndCallConfirmation(context),      child: Container(        width: 14.w,        height: 14.w,        decoration: const BoxDecoration(          color: Colors.red,          shape: BoxShape.circle,        ),        child: Center(          child: CustomIconWidget(            iconName: 'call_end',            color: Colors.white,            size: 24.sp,          ),        ),      ),    );  }  void _showEndCallConfirmation(BuildContext context) {    showDialog(      context: context,      barrierDismissible: false,      builder: (BuildContext context) {        return AlertDialog(          title: Text(            'End Call',            style: Theme.of(context).textTheme.titleLarge,          ),          content: Text(            'Are you sure you want to end this consultation?',            style: Theme.of(context).textTheme.bodyMedium,          ),          actions: [            TextButton(              onPressed: () => Navigator.of(context).pop(),              child: Text(                'Cancel',                style: TextStyle(                  color: Theme.of(context).colorScheme.onSurface,                  fontSize: 14.sp,                ),              ),            ),            ElevatedButton(              onPressed: () {                Navigator.of(context).pop();                _handleControlTap(widget.onEndCall);              },              style: ElevatedButton.styleFrom(                backgroundColor: Colors.red,                foregroundColor: Colors.white,              ),              child: Text(                'End Call',                style: TextStyle(fontSize: 14.sp),              ),            ),          ],        );      },    );  }}