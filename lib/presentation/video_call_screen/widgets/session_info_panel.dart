import 'package:flutter/material.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';import '../../../widgets/custom_icon_widget.dart';/// Session information panel that slides from the edge/// Shows consultation details and agreed durationclass SessionInfoPanel extends StatefulWidget {  final bool isVisible;  final String clientName;  final String consultationType;  final Duration sessionDuration;  final Duration elapsedTime;  final double ratePerMinute;  final String sessionId;  final VoidCallback onClose;  const SessionInfoPanel({    super.key,    required this.isVisible,    required this.clientName,    required this.consultationType,    required this.sessionDuration,    required this.elapsedTime,    required this.ratePerMinute,    required this.sessionId,    required this.onClose,  });  @override  State<SessionInfoPanel> createState() => _SessionInfoPanelState();}class _SessionInfoPanelState extends State<SessionInfoPanel>    with SingleTickerProviderStateMixin {  late AnimationController _animationController;  late Animation<Offset> _slideAnimation;  @override  void initState() {    super.initState();    _animationController = AnimationController(      duration: const Duration(milliseconds: 300),      vsync: this,    );    _slideAnimation = Tween<Offset>(      begin: const Offset(1.0, 0.0),      end: Offset.zero,    ).animate(CurvedAnimation(      parent: _animationController,      curve: Curves.easeInOut,    ));    if (widget.isVisible) {      _animationController.forward();    }  }  @override  void didUpdateWidget(SessionInfoPanel oldWidget) {    super.didUpdateWidget(oldWidget);    if (widget.isVisible != oldWidget.isVisible) {      if (widget.isVisible) {        _animationController.forward();      } else {        _animationController.reverse();      }    }  }  @override  void dispose() {    _animationController.dispose();    super.dispose();  }  String _formatDuration(Duration duration) {    String twoDigits(int n) => n.toString().padLeft(2, '0');    String twoDigitMinutes = twoDigits(duration.inMinutes.remainder(60));    String twoDigitSeconds = twoDigits(duration.inSeconds.remainder(60));    return "${twoDigits(duration.inHours)}:$twoDigitMinutes:$twoDigitSeconds";  }  double get _currentEarnings {    return (widget.elapsedTime.inMinutes * widget.ratePerMinute);  }  @override  Widget build(BuildContext context) {    return SlideTransition(      position: _slideAnimation,      child: Container(        width: 80.w,        height: double.infinity,        decoration: BoxDecoration(          color: Theme.of(context).colorScheme.surface,          boxShadow: [            BoxShadow(              color: Colors.black.withValues(alpha: 0.3),              blurRadius: 10,              offset: const Offset(-2, 0),            ),          ],        ),        child: SafeArea(          child: Column(            crossAxisAlignment: CrossAxisAlignment.start,            children: [              _buildHeader(context),              Expanded(                child: SingleChildScrollView(                  padding: EdgeInsets.all(4.w),                  child: Column(                    crossAxisAlignment: CrossAxisAlignment.start,                    children: [                      _buildClientInfo(context),                      SizedBox(height: 3.h),                      _buildSessionDetails(context),                      SizedBox(height: 3.h),                      _buildTimingInfo(context),                      SizedBox(height: 3.h),                      _buildEarningsInfo(context),                    ],                  ),                ),              ),            ],          ),        ),      ),    );  }  Widget _buildHeader(BuildContext context) {    return Container(      padding: EdgeInsets.all(4.w),      decoration: BoxDecoration(        color: Theme.of(context).colorScheme.primary,        borderRadius: const BorderRadius.only(          bottomLeft: Radius.circular(16),          bottomRight: Radius.circular(16),        ),      ),      child: Row(        children: [          Text(            'Session Info',            style: Theme.of(context).textTheme.titleMedium?.copyWith(              color: Theme.of(context).colorScheme.onPrimary,              fontWeight: FontWeight.w600,            ),          ),          const Spacer(),          GestureDetector(            onTap: widget.onClose,            child: Container(              padding: EdgeInsets.all(1.w),              decoration: BoxDecoration(                color: Colors.white.withValues(alpha: 0.2),                borderRadius: BorderRadius.circular(6),              ),              child: CustomIconWidget(                iconName: 'close',                color: Theme.of(context).colorScheme.onPrimary,                size: 18.sp,              ),            ),          ),        ],      ),    );  }  Widget _buildClientInfo(BuildContext context) {    return Container(      padding: EdgeInsets.all(3.w),      decoration: BoxDecoration(        color: Theme.of(context).colorScheme.primaryContainer,        borderRadius: BorderRadius.circular(12),      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Client Information',            style: Theme.of(context).textTheme.titleSmall?.copyWith(              fontWeight: FontWeight.w600,            ),          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'person',                color: Theme.of(context).colorScheme.primary,                size: 16.sp,              ),              SizedBox(width: 2.w),              Expanded(                child: Text(                  widget.clientName,                  style: Theme.of(context).textTheme.bodyMedium?.copyWith(                    fontWeight: FontWeight.w500,                  ),                  overflow: TextOverflow.ellipsis,                ),              ),            ],          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'category',                color: Theme.of(context).colorScheme.primary,                size: 16.sp,              ),              SizedBox(width: 2.w),              Expanded(                child: Text(                  widget.consultationType,                  style: Theme.of(context).textTheme.bodyMedium,                  overflow: TextOverflow.ellipsis,                ),              ),            ],          ),        ],      ),    );  }  Widget _buildSessionDetails(BuildContext context) {    return Container(      padding: EdgeInsets.all(3.w),      decoration: BoxDecoration(        color: Theme.of(context).colorScheme.secondaryContainer,        borderRadius: BorderRadius.circular(12),      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Session Details',            style: Theme.of(context).textTheme.titleSmall?.copyWith(              fontWeight: FontWeight.w600,            ),          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'schedule',                color: Theme.of(context).colorScheme.secondary,                size: 16.sp,              ),              SizedBox(width: 2.w),              Text(                'Duration: ${_formatDuration(widget.sessionDuration)}',                style: Theme.of(context).textTheme.bodyMedium,              ),            ],          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'confirmation_number',                color: Theme.of(context).colorScheme.secondary,                size: 16.sp,              ),              SizedBox(width: 2.w),              Expanded(                child: Text(                  'ID: ${widget.sessionId}',                  style: Theme.of(context).textTheme.bodySmall,                  overflow: TextOverflow.ellipsis,                ),              ),            ],          ),        ],      ),    );  }  Widget _buildTimingInfo(BuildContext context) {    final remainingTime = widget.sessionDuration - widget.elapsedTime;    final isOvertime = remainingTime.isNegative;    return Container(      padding: EdgeInsets.all(3.w),      decoration: BoxDecoration(        color: isOvertime            ? Colors.orange.withValues(alpha: 0.1)            : Theme.of(context).colorScheme.tertiaryContainer,        borderRadius: BorderRadius.circular(12),        border: isOvertime ? Border.all(color: Colors.orange, width: 1) : null,      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Timing Information',            style: Theme.of(context).textTheme.titleSmall?.copyWith(              fontWeight: FontWeight.w600,            ),          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'play_circle',                color: Colors.green,                size: 16.sp,              ),              SizedBox(width: 2.w),              Text(                'Elapsed: ${_formatDuration(widget.elapsedTime)}',                style: Theme.of(context).textTheme.bodyMedium,              ),            ],          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: isOvertime ? 'warning' : 'timer',                color: isOvertime ? Colors.orange : Colors.blue,                size: 16.sp,              ),              SizedBox(width: 2.w),              Text(                isOvertime                    ? 'Overtime: ${_formatDuration(remainingTime.abs())}'                    : 'Remaining: ${_formatDuration(remainingTime)}',                style: Theme.of(context).textTheme.bodyMedium?.copyWith(                  color: isOvertime ? Colors.orange : null,                ),              ),            ],          ),        ],      ),    );  }  Widget _buildEarningsInfo(BuildContext context) {    return Container(      padding: EdgeInsets.all(3.w),      decoration: BoxDecoration(        color: Colors.green.withValues(alpha: 0.1),        borderRadius: BorderRadius.circular(12),        border: Border.all(color: Colors.green, width: 1),      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Earnings Information',            style: Theme.of(context).textTheme.titleSmall?.copyWith(              fontWeight: FontWeight.w600,            ),          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'attach_money',                color: Colors.green,                size: 16.sp,              ),              SizedBox(width: 2.w),              Text(                'Rate: \$${widget.ratePerMinute.toStringAsFixed(2)}/min',                style: Theme.of(context).textTheme.bodyMedium,              ),            ],          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'account_balance_wallet',                color: Colors.green,                size: 16.sp,              ),              SizedBox(width: 2.w),              Text(                'Current: \$${_currentEarnings.toStringAsFixed(2)}',                style: Theme.of(context).textTheme.bodyMedium?.copyWith(                  fontWeight: FontWeight.w600,                  color: Colors.green,                ),              ),            ],          ),        ],      ),    );  }}