import 'package:flutter/material.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';import '../../../widgets/custom_icon_widget.dart';/// Notes panel that slides up from bottom for taking consultation notes/// Allows note-taking without obscuring video feedsclass NotesPanel extends StatefulWidget {  final bool isVisible;  final String initialNotes;  final ValueChanged<String> onNotesChanged;  final VoidCallback onClose;  final VoidCallback onSave;  const NotesPanel({    super.key,    required this.isVisible,    required this.initialNotes,    required this.onNotesChanged,    required this.onClose,    required this.onSave,  });  @override  State<NotesPanel> createState() => _NotesPanelState();}class _NotesPanelState extends State<NotesPanel>    with SingleTickerProviderStateMixin {  late AnimationController _animationController;  late Animation<Offset> _slideAnimation;  late TextEditingController _notesController;  final FocusNode _focusNode = FocusNode();  @override  void initState() {    super.initState();    _notesController = TextEditingController(text: widget.initialNotes);    _animationController = AnimationController(      duration: const Duration(milliseconds: 300),      vsync: this,    );    _slideAnimation = Tween<Offset>(      begin: const Offset(0.0, 1.0),      end: Offset.zero,    ).animate(CurvedAnimation(      parent: _animationController,      curve: Curves.easeInOut,    ));    if (widget.isVisible) {      _animationController.forward();      WidgetsBinding.instance.addPostFrameCallback((_) {        _focusNode.requestFocus();      });    }  }  @override  void didUpdateWidget(NotesPanel oldWidget) {    super.didUpdateWidget(oldWidget);    if (widget.isVisible != oldWidget.isVisible) {      if (widget.isVisible) {        _animationController.forward();        WidgetsBinding.instance.addPostFrameCallback((_) {          _focusNode.requestFocus();        });      } else {        _animationController.reverse();        _focusNode.unfocus();      }    }    if (widget.initialNotes != oldWidget.initialNotes) {      _notesController.text = widget.initialNotes;    }  }  @override  void dispose() {    _notesController.dispose();    _focusNode.dispose();    _animationController.dispose();    super.dispose();  }  void _handleNotesChange() {    widget.onNotesChanged(_notesController.text);  }  @override  Widget build(BuildContext context) {    return SlideTransition(      position: _slideAnimation,      child: Container(        height: 50.h,        width: double.infinity,        decoration: BoxDecoration(          color: Theme.of(context).colorScheme.surface,          borderRadius: const BorderRadius.only(            topLeft: Radius.circular(20),            topRight: Radius.circular(20),          ),          boxShadow: [            BoxShadow(              color: Colors.black.withValues(alpha: 0.2),              blurRadius: 10,              offset: const Offset(0, -2),            ),          ],        ),        child: Column(          children: [            _buildHeader(context),            Expanded(              child: _buildNotesContent(context),            ),            _buildFooter(context),          ],        ),      ),    );  }  Widget _buildHeader(BuildContext context) {    return Container(      padding: EdgeInsets.symmetric(horizontal: 4.w, vertical: 2.h),      decoration: BoxDecoration(        color: Theme.of(context).colorScheme.primaryContainer,        borderRadius: const BorderRadius.only(          topLeft: Radius.circular(20),          topRight: Radius.circular(20),        ),      ),      child: Column(        children: [          // Drag handle          Container(            width: 10.w,            height: 0.5.h,            decoration: BoxDecoration(              color: Theme.of(context).colorScheme.onSurfaceVariant,              borderRadius: BorderRadius.circular(2),            ),          ),          SizedBox(height: 1.h),          Row(            children: [              CustomIconWidget(                iconName: 'edit_note',                color: Theme.of(context).colorScheme.primary,                size: 20.sp,              ),              SizedBox(width: 2.w),              Text(                'Consultation Notes',                style: Theme.of(context).textTheme.titleMedium?.copyWith(                  fontWeight: FontWeight.w600,                ),              ),              const Spacer(),              GestureDetector(                onTap: widget.onClose,                child: Container(                  padding: EdgeInsets.all(1.w),                  decoration: BoxDecoration(                    color: Theme.of(context)                        .colorScheme                        .outline                        .withValues(alpha: 0.2),                    borderRadius: BorderRadius.circular(6),                  ),                  child: CustomIconWidget(                    iconName: 'keyboard_arrow_down',                    color: Theme.of(context).colorScheme.onSurface,                    size: 18.sp,                  ),                ),              ),            ],          ),        ],      ),    );  }  Widget _buildNotesContent(BuildContext context) {    return Container(      padding: EdgeInsets.all(4.w),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Add your consultation notes here:',            style: Theme.of(context).textTheme.bodyMedium?.copyWith(              color: Theme.of(context).colorScheme.onSurfaceVariant,            ),          ),          SizedBox(height: 2.h),          Expanded(            child: Container(              decoration: BoxDecoration(                border: Border.all(                  color: Theme.of(context).colorScheme.outline,                  width: 1,                ),                borderRadius: BorderRadius.circular(12),              ),              child: TextField(                controller: _notesController,                focusNode: _focusNode,                maxLines: null,                expands: true,                textAlignVertical: TextAlignVertical.top,                onChanged: (_) => _handleNotesChange(),                decoration: InputDecoration(                  hintText:                  'Enter consultation notes, observations, recommendations...',                  hintStyle: Theme.of(context).textTheme.bodyMedium?.copyWith(                    color: Theme.of(context)                        .colorScheme                        .onSurfaceVariant                        .withValues(alpha: 0.6),                  ),                  border: InputBorder.none,                  contentPadding: EdgeInsets.all(3.w),                ),                style: Theme.of(context).textTheme.bodyMedium,              ),            ),          ),        ],      ),    );  }  Widget _buildFooter(BuildContext context) {    return Container(      padding: EdgeInsets.all(4.w),      decoration: BoxDecoration(        color: Theme.of(context).colorScheme.surface,        border: Border(          top: BorderSide(            color: Theme.of(context).colorScheme.outline.withValues(alpha: 0.3),            width: 1,          ),        ),      ),      child: Row(        children: [          Expanded(            child: OutlinedButton(              onPressed: widget.onClose,              child: Text(                'Cancel',                style: TextStyle(fontSize: 14.sp),              ),            ),          ),          SizedBox(width: 4.w),          Expanded(            child: ElevatedButton(              onPressed: () {                widget.onSave();                widget.onClose();              },              child: Row(                mainAxisAlignment: MainAxisAlignment.center,                children: [                  CustomIconWidget(                    iconName: 'save',                    color: Theme.of(context).colorScheme.onPrimary,                    size: 16.sp,                  ),                  SizedBox(width: 2.w),                  Text(                    'Save Notes',                    style: TextStyle(fontSize: 14.sp),                  ),                ],              ),            ),          ),        ],      ),    );  }}