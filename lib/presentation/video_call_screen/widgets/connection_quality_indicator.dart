import 'package:flutter/material.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';import '../../../widgets/custom_icon_widget.dart';/// Connection quality indicator widget/// Shows network quality and provides improvement suggestionsclass ConnectionQualityIndicator extends StatefulWidget {  final ConnectionQuality quality;  final bool isVisible;  final VoidCallback? onDismiss;  const ConnectionQualityIndicator({    super.key,    required this.quality,    required this.isVisible,    this.onDismiss,  });  @override  State<ConnectionQualityIndicator> createState() =>      _ConnectionQualityIndicatorState();}class _ConnectionQualityIndicatorState extends State<ConnectionQualityIndicator>    with SingleTickerProviderStateMixin {  late AnimationController _animationController;  late Animation<double> _scaleAnimation;  @override  void initState() {    super.initState();    _animationController = AnimationController(      duration: const Duration(milliseconds: 300),      vsync: this,    );    _scaleAnimation = Tween<double>(      begin: 0.0,      end: 1.0,    ).animate(CurvedAnimation(      parent: _animationController,      curve: Curves.elasticOut,    ));    if (widget.isVisible) {      _animationController.forward();    }  }  @override  void didUpdateWidget(ConnectionQualityIndicator oldWidget) {    super.didUpdateWidget(oldWidget);    if (widget.isVisible != oldWidget.isVisible) {      if (widget.isVisible) {        _animationController.forward();      } else {        _animationController.reverse();      }    }  }  @override  void dispose() {    _animationController.dispose();    super.dispose();  }  Color _getQualityColor() {    switch (widget.quality) {      case ConnectionQuality.excellent:        return Colors.green;      case ConnectionQuality.good:        return Colors.blue;      case ConnectionQuality.fair:        return Colors.orange;      case ConnectionQuality.poor:        return Colors.red;    }  }  String _getQualityText() {    switch (widget.quality) {      case ConnectionQuality.excellent:        return 'Excellent';      case ConnectionQuality.good:        return 'Good';      case ConnectionQuality.fair:        return 'Fair';      case ConnectionQuality.poor:        return 'Poor';    }  }  String _getQualityIcon() {    switch (widget.quality) {      case ConnectionQuality.excellent:        return 'signal_cellular_4_bar';      case ConnectionQuality.good:        return 'signal_cellular_3_bar';      case ConnectionQuality.fair:        return 'signal_cellular_2_bar';      case ConnectionQuality.poor:        return 'signal_cellular_1_bar';    }  }  List<String> _getImprovementSuggestions() {    switch (widget.quality) {      case ConnectionQuality.excellent:        return ['Connection is optimal'];      case ConnectionQuality.good:        return ['Connection is stable'];      case ConnectionQuality.fair:        return [          'Move closer to your router',          'Close other apps using internet',          'Check if others are using WiFi heavily'        ];      case ConnectionQuality.poor:        return [          'Move closer to your router',          'Switch to mobile data if available',          'Close all other apps',          'Restart your router if possible',          'Consider ending call and reconnecting'        ];    }  }  @override  Widget build(BuildContext context) {    if (!widget.isVisible) return const SizedBox.shrink();    return ScaleTransition(      scale: _scaleAnimation,      child: Positioned(        top: 15.h,        left: 4.w,        right: 4.w,        child: Container(          margin: EdgeInsets.symmetric(horizontal: 4.w),          padding: EdgeInsets.all(3.w),          decoration: BoxDecoration(            color: Theme.of(context).colorScheme.surface,            borderRadius: BorderRadius.circular(12),            border: Border.all(              color: _getQualityColor(),              width: 2,            ),            boxShadow: [              BoxShadow(                color: Colors.black.withValues(alpha: 0.2),                blurRadius: 8,                offset: const Offset(0, 2),              ),            ],          ),          child: Column(            crossAxisAlignment: CrossAxisAlignment.start,            mainAxisSize: MainAxisSize.min,            children: [              _buildHeader(context),              if (widget.quality == ConnectionQuality.fair ||                  widget.quality == ConnectionQuality.poor) ...[                SizedBox(height: 2.h),                _buildSuggestions(context),              ],            ],          ),        ),      ),    );  }  Widget _buildHeader(BuildContext context) {    return Row(      children: [        Container(          padding: EdgeInsets.all(1.5.w),          decoration: BoxDecoration(            color: _getQualityColor().withValues(alpha: 0.1),            borderRadius: BorderRadius.circular(8),          ),          child: CustomIconWidget(            iconName: _getQualityIcon(),            color: _getQualityColor(),            size: 18.sp,          ),        ),        SizedBox(width: 3.w),        Expanded(          child: Column(            crossAxisAlignment: CrossAxisAlignment.start,            children: [              Text(                'Connection Quality',                style: Theme.of(context).textTheme.bodySmall?.copyWith(                  color: Theme.of(context).colorScheme.onSurfaceVariant,                ),              ),              Text(                _getQualityText(),                style: Theme.of(context).textTheme.titleSmall?.copyWith(                  color: _getQualityColor(),                  fontWeight: FontWeight.w600,                ),              ),            ],          ),        ),        if (widget.onDismiss != null)          GestureDetector(            onTap: widget.onDismiss,            child: Container(              padding: EdgeInsets.all(1.w),              decoration: BoxDecoration(                color: Theme.of(context)                    .colorScheme                    .outline                    .withValues(alpha: 0.2),                borderRadius: BorderRadius.circular(6),              ),              child: CustomIconWidget(                iconName: 'close',                color: Theme.of(context).colorScheme.onSurfaceVariant,                size: 16.sp,              ),            ),          ),      ],    );  }  Widget _buildSuggestions(BuildContext context) {    final suggestions = _getImprovementSuggestions();    return Container(      padding: EdgeInsets.all(2.w),      decoration: BoxDecoration(        color: _getQualityColor().withValues(alpha: 0.05),        borderRadius: BorderRadius.circular(8),      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Suggestions to improve:',            style: Theme.of(context).textTheme.bodySmall?.copyWith(              fontWeight: FontWeight.w600,              color: _getQualityColor(),            ),          ),          SizedBox(height: 1.h),          ...suggestions              .map((suggestion) => Padding(            padding: EdgeInsets.only(bottom: 0.5.h),            child: Row(              crossAxisAlignment: CrossAxisAlignment.start,              children: [                Container(                  margin: EdgeInsets.only(top: 0.5.h),                  width: 1.w,                  height: 1.w,                  decoration: BoxDecoration(                    color: _getQualityColor(),                    shape: BoxShape.circle,                  ),                ),                SizedBox(width: 2.w),                Expanded(                  child: Text(                    suggestion,                    style: Theme.of(context)                        .textTheme                        .bodySmall                        ?.copyWith(                      color:                      Theme.of(context).colorScheme.onSurface,                    ),                  ),                ),              ],            ),          ))              .toList(),        ],      ),    );  }}/// Enum for connection quality levelsenum ConnectionQuality {  excellent,  good,  fair,  poor,}