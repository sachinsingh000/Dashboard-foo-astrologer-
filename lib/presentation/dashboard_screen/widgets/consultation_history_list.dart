import 'package:flutter/material.dart';import 'package:flutter_slidable/flutter_slidable.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';class ConsultationHistoryList extends StatelessWidget { final List<Map<String, dynamic>> consultations; final VoidCallback onRefresh; const ConsultationHistoryList({  super.key,  required this.consultations,  required this.onRefresh, }); @override Widget build(BuildContext context) {  final theme = Theme.of(context);  return Container(   margin: EdgeInsets.symmetric(horizontal: 4.w),   child: Column(    crossAxisAlignment: CrossAxisAlignment.start,    children: [     Row(      mainAxisAlignment: MainAxisAlignment.spaceBetween,      children: [       Text(        'Recent Consultations',        style: theme.textTheme.titleLarge?.copyWith(         fontWeight: FontWeight.w600,        ),       ),       TextButton(        onPressed: () => Navigator.pushNamed(            context, '/consultation-requests-screen'),        child: Text('View All'),       ),      ],     ),     SizedBox(height: 1.h),     consultations.isEmpty         ? _buildEmptyState(context)         : ListView.builder(      shrinkWrap: true,      physics: const NeverScrollableScrollPhysics(),      itemCount:      consultations.length > 5 ? 5 : consultations.length,      itemBuilder: (context, index) {       final consultation = consultations[index];       return _buildConsultationItem(context, consultation);      },     ),    ],   ),  ); } Widget _buildEmptyState(BuildContext context) {  final theme = Theme.of(context);  return Container(   width: double.infinity,   padding: EdgeInsets.all(8.w),   decoration: BoxDecoration(    color: theme.colorScheme.surface,    borderRadius: BorderRadius.circular(16),    border: Border.all(     color: theme.colorScheme.outline.withValues(alpha: 0.2),    ),   ),   child: Column(    children: [     Container(      width: 20.w,      height: 20.w,      decoration: BoxDecoration(       color: theme.colorScheme.primary.withValues(alpha: 0.1),       shape: BoxShape.circle,      ),      child: CustomIconWidget(       iconName: 'psychology',       color: theme.colorScheme.primary,       size: 32,      ),     ),     SizedBox(height: 2.h),     Text(      'Start Your Journey',      style: theme.textTheme.titleMedium?.copyWith(       fontWeight: FontWeight.w600,      ),     ),     SizedBox(height: 1.h),     Text(      'Go online to start receiving consultation requests from clients seeking your guidance.',      style: theme.textTheme.bodyMedium?.copyWith(       color: theme.colorScheme.onSurfaceVariant,      ),      textAlign: TextAlign.center,     ),     SizedBox(height: 2.h),     ElevatedButton(      onPressed: onRefresh,      child: Text('Go Online'),     ),    ],   ),  ); } Widget _buildConsultationItem(     BuildContext context, Map<String, dynamic> consultation) {  final theme = Theme.of(context);  final clientName = consultation['clientName'] as String;  final serviceType = consultation['serviceType'] as String;  final duration = consultation['duration'] as String;  final earnings = consultation['earnings'] as double;  final timestamp = consultation['timestamp'] as DateTime;  final status = consultation['status'] as String;  return Slidable(   key: ValueKey(consultation['id']),   endActionPane: ActionPane(    motion: const ScrollMotion(),    children: [     SlidableAction(      onPressed: (context) => _viewDetails(context, consultation),      backgroundColor: theme.colorScheme.primary,      foregroundColor: theme.colorScheme.onPrimary,      icon: Icons.visibility,      label: 'Details',     ),     SlidableAction(      onPressed: (context) => _sendFollowUp(context, consultation),      backgroundColor: AppTheme.getSuccessColor(context),      foregroundColor: theme.colorScheme.onPrimary,      icon: Icons.send,      label: 'Follow-up',     ),     SlidableAction(      onPressed: (context) => _rateClient(context, consultation),      backgroundColor: AppTheme.getWarningColor(context),      foregroundColor: theme.colorScheme.onPrimary,      icon: Icons.star,      label: 'Rate',     ),    ],   ),   child: Container(    margin: EdgeInsets.only(bottom: 2.h),    padding: EdgeInsets.all(4.w),    decoration: BoxDecoration(     color: theme.colorScheme.surface,     borderRadius: BorderRadius.circular(12),     border: Border.all(      color: theme.colorScheme.outline.withValues(alpha: 0.2),     ),    ),    child: Row(     children: [      Container(       width: 12.w,       height: 12.w,       decoration: BoxDecoration(        color: theme.colorScheme.primary.withValues(alpha: 0.1),        shape: BoxShape.circle,       ),       child: Center(        child: Text(         _getInitials(clientName),         style: theme.textTheme.titleMedium?.copyWith(          color: theme.colorScheme.primary,          fontWeight: FontWeight.w600,         ),        ),       ),      ),      SizedBox(width: 3.w),      Expanded(       child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [         Row(          children: [           Expanded(            child: Text(             clientName,             style: theme.textTheme.titleMedium?.copyWith(              fontWeight: FontWeight.w600,             ),             overflow: TextOverflow.ellipsis,            ),           ),           Container(            padding: EdgeInsets.symmetric(                horizontal: 2.w, vertical: 0.5.h),            decoration: BoxDecoration(             color: _getStatusColor(context, status)                 .withValues(alpha: 0.1),             borderRadius: BorderRadius.circular(8),            ),            child: Text(             status,             style: theme.textTheme.labelSmall?.copyWith(              color: _getStatusColor(context, status),              fontWeight: FontWeight.w600,             ),            ),           ),          ],         ),         SizedBox(height: 0.5.h),         Row(          children: [           CustomIconWidget(            iconName: _getServiceIcon(serviceType),            color: theme.colorScheme.onSurfaceVariant,            size: 14,           ),           SizedBox(width: 1.w),           Text(            serviceType,            style: theme.textTheme.bodySmall?.copyWith(             color: theme.colorScheme.onSurfaceVariant,            ),           ),           SizedBox(width: 2.w),           CustomIconWidget(            iconName: 'schedule',            color: theme.colorScheme.onSurfaceVariant,            size: 14,           ),           SizedBox(width: 1.w),           Text(            duration,            style: theme.textTheme.bodySmall?.copyWith(             color: theme.colorScheme.onSurfaceVariant,            ),           ),          ],         ),         SizedBox(height: 0.5.h),         Row(          mainAxisAlignment: MainAxisAlignment.spaceBetween,          children: [           Text(            _formatTimestamp(timestamp),            style: theme.textTheme.bodySmall?.copyWith(             color: theme.colorScheme.onSurfaceVariant,            ),           ),           Text(            '\$${earnings.toStringAsFixed(2)}',            style: theme.textTheme.titleMedium?.copyWith(             color: AppTheme.getSuccessColor(context),             fontWeight: FontWeight.w600,            ),           ),          ],         ),        ],       ),      ),     ],    ),   ),  ); } String _getInitials(String name) {  final parts = name.split(' ');  if (parts.length >= 2) {   return '${parts[0][0]}${parts[1][0]}'.toUpperCase();  }  return name.isNotEmpty ? name[0].toUpperCase() : 'U'; } String _getServiceIcon(String serviceType) {  switch (serviceType.toLowerCase()) {   case 'chat':    return 'chat';   case 'audio call':    return 'call';   case 'video call':    return 'videocam';   case 'report':    return 'description';   default:    return 'psychology';  } } Color _getStatusColor(BuildContext context, String status) {  switch (status.toLowerCase()) {   case 'completed':    return AppTheme.getSuccessColor(context);   case 'pending':    return AppTheme.getWarningColor(context);   case 'cancelled':    return Theme.of(context).colorScheme.error;   default:    return Theme.of(context).colorScheme.onSurfaceVariant;  } } String _formatTimestamp(DateTime timestamp) {  final now = DateTime.now();  final difference = now.difference(timestamp);  if (difference.inDays > 0) {   return '${difference.inDays}d ago';  } else if (difference.inHours > 0) {   return '${difference.inHours}h ago';  } else if (difference.inMinutes > 0) {   return '${difference.inMinutes}m ago';  } else {   return 'Just now';  } } void _viewDetails(BuildContext context, Map<String, dynamic> consultation) {  showModalBottomSheet(   context: context,   isScrollControlled: true,   backgroundColor: Colors.transparent,   builder: (context) => Container(    height: 60.h,    decoration: BoxDecoration(     color: Theme.of(context).colorScheme.surface,     borderRadius: const BorderRadius.vertical(top: Radius.circular(20)),    ),    padding: EdgeInsets.all(4.w),    child: Column(     crossAxisAlignment: CrossAxisAlignment.start,     children: [      Center(       child: Container(        width: 12.w,        height: 0.5.h,        decoration: BoxDecoration(         color: Theme.of(context).colorScheme.outline,         borderRadius: BorderRadius.circular(2),        ),       ),      ),      SizedBox(height: 3.h),      Text(       'Consultation Details',       style: Theme.of(context).textTheme.headlineSmall,      ),      SizedBox(height: 2.h),      Text(       'Client: ${consultation['clientName']}',       style: Theme.of(context).textTheme.bodyLarge,      ),      Text(       'Service: ${consultation['serviceType']}',       style: Theme.of(context).textTheme.bodyLarge,      ),      Text(       'Duration: ${consultation['duration']}',       style: Theme.of(context).textTheme.bodyLarge,      ),      Text(       'Earnings: \$${(consultation['earnings'] as double).toStringAsFixed(2)}',       style: Theme.of(context).textTheme.bodyLarge,      ),     ],    ),   ),  ); } void _sendFollowUp(BuildContext context, Map<String, dynamic> consultation) {  Navigator.pushNamed(context, '/chat-interface-screen'); } void _rateClient(BuildContext context, Map<String, dynamic> consultation) {  showDialog(   context: context,   builder: (context) => AlertDialog(    title: Text('Rate Client'),    content:    Text('Rate your experience with ${consultation['clientName']}'),    actions: [     TextButton(      onPressed: () => Navigator.pop(context),      child: Text('Cancel'),     ),     ElevatedButton(      onPressed: () => Navigator.pop(context),      child: Text('Submit'),     ),    ],   ),  ); }}