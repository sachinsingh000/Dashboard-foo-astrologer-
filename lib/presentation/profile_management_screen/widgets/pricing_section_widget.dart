import 'package:flutter/material.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';import '../../../widgets/custom_icon_widget.dart';class PricingSectionWidget extends StatefulWidget { final Map<String, double> pricing; final Function(Map<String, double>) onPricingChanged; final VoidCallback onSave; final bool isLoading; const PricingSectionWidget({  super.key,  required this.pricing,  required this.onPricingChanged,  required this.onSave,  this.isLoading = false, }); @override State<PricingSectionWidget> createState() => _PricingSectionWidgetState();}class _PricingSectionWidgetState extends State<PricingSectionWidget> { late Map<String, double> _tempPricing; final Map<String, TextEditingController> _controllers = {}; @override void initState() {  super.initState();  _tempPricing = Map.from(widget.pricing);  // Initialize controllers  _controllers['chat'] =      TextEditingController(text: _tempPricing['chat']?.toString() ?? '0');  _controllers['audio'] =      TextEditingController(text: _tempPricing['audio']?.toString() ?? '0');  _controllers['video'] =      TextEditingController(text: _tempPricing['video']?.toString() ?? '0');  _controllers['report'] =      TextEditingController(text: _tempPricing['report']?.toString() ?? '0'); } @override void dispose() {  _controllers.values.forEach((controller) => controller.dispose());  super.dispose(); } Widget _buildPricingCard({  required String type,  required String title,  required String subtitle,  required IconData icon,  required bool isPerMinute,  required double minValue,  required double maxValue, }) {  return Container(   padding: EdgeInsets.all(4.w),   decoration: BoxDecoration(    color: Theme.of(context)        .colorScheme        .primaryContainer        .withValues(alpha: 0.1),    borderRadius: BorderRadius.circular(12),    border: Border.all(     color: Theme.of(context).colorScheme.outline.withValues(alpha: 0.3),    ),   ),   child: Column(    crossAxisAlignment: CrossAxisAlignment.start,    children: [     Row(      children: [       Container(        padding: EdgeInsets.all(2.w),        decoration: BoxDecoration(         color: Theme.of(context).colorScheme.primary,         borderRadius: BorderRadius.circular(8),        ),        child: CustomIconWidget(         iconName: icon.toString().split('.').last,         size: 5.w,         color: Theme.of(context).colorScheme.onPrimary,        ),       ),       SizedBox(width: 3.w),       Expanded(        child: Column(         crossAxisAlignment: CrossAxisAlignment.start,         children: [          Text(           title,           style: Theme.of(context).textTheme.titleSmall?.copyWith(            fontWeight: FontWeight.w600,           ),          ),          Text(           subtitle,           style: Theme.of(context).textTheme.labelSmall?.copyWith(            color:            Theme.of(context).colorScheme.onSurfaceVariant,           ),          ),         ],        ),       ),      ],     ),     SizedBox(height: 2.h),     if (isPerMinute) ...[      Text(       'Rate per minute: \$${_tempPricing[type]?.toStringAsFixed(2) ?? '0.00'}',       style: Theme.of(context).textTheme.bodyMedium?.copyWith(        fontWeight: FontWeight.w600,        color: Theme.of(context).colorScheme.primary,       ),      ),      SizedBox(height: 1.h),      Slider(       value: _tempPricing[type] ?? minValue,       min: minValue,       max: maxValue,       divisions: ((maxValue - minValue) * 4).toInt(),       onChanged: (value) {        setState(() {         _tempPricing[type] = value;         _controllers[type]?.text = value.toStringAsFixed(2);        });        widget.onPricingChanged(_tempPricing);       },       activeColor: Theme.of(context).colorScheme.primary,       inactiveColor: Theme.of(context).colorScheme.outline,      ),      Row(       mainAxisAlignment: MainAxisAlignment.spaceBetween,       children: [        Text(         '\$${minValue.toStringAsFixed(2)}',         style: Theme.of(context).textTheme.labelSmall,        ),        Text(         '\$${maxValue.toStringAsFixed(2)}',         style: Theme.of(context).textTheme.labelSmall,        ),       ],      ),     ] else ...[      TextField(       controller: _controllers[type],       keyboardType: TextInputType.numberWithOptions(decimal: true),       onChanged: (value) {        final price = double.tryParse(value) ?? 0.0;        setState(() {         _tempPricing[type] = price;        });        widget.onPricingChanged(_tempPricing);       },       decoration: InputDecoration(        labelText: 'Fixed Price (\$)',        prefixText: '\$ ',        border: OutlineInputBorder(         borderRadius: BorderRadius.circular(8),        ),        enabledBorder: OutlineInputBorder(         borderRadius: BorderRadius.circular(8),         borderSide: BorderSide(          color: Theme.of(context).colorScheme.outline,         ),        ),        focusedBorder: OutlineInputBorder(         borderRadius: BorderRadius.circular(8),         borderSide: BorderSide(          color: Theme.of(context).colorScheme.primary,          width: 2,         ),        ),       ),      ),     ],    ],   ),  ); } @override Widget build(BuildContext context) {  return Container(   width: double.infinity,   padding: EdgeInsets.all(4.w),   decoration: BoxDecoration(    color: Theme.of(context).colorScheme.surface,    borderRadius: BorderRadius.circular(16),    boxShadow: [     BoxShadow(      color: Theme.of(context).shadowColor.withValues(alpha: 0.1),      blurRadius: 8,      offset: const Offset(0, 2),     ),    ],   ),   child: Column(    crossAxisAlignment: CrossAxisAlignment.start,    children: [     Row(      children: [       CustomIconWidget(        iconName: 'attach_money',        size: 6.w,        color: Theme.of(context).colorScheme.primary,       ),       SizedBox(width: 3.w),       Text(        'Pricing Configuration',        style: Theme.of(context).textTheme.titleMedium?.copyWith(         fontWeight: FontWeight.w600,        ),       ),      ],     ),     SizedBox(height: 2.h),     Text(      'Set your consultation rates to attract the right clients',      style: Theme.of(context).textTheme.bodySmall?.copyWith(       color: Theme.of(context).colorScheme.onSurfaceVariant,      ),     ),     SizedBox(height: 3.h),     _buildPricingCard(      type: 'chat',      title: 'Chat Consultation',      subtitle: 'Text-based consultations',      icon: Icons.chat,      isPerMinute: true,      minValue: 0.50,      maxValue: 5.00,     ),     SizedBox(height: 2.h),     _buildPricingCard(      type: 'audio',      title: 'Audio Call',      subtitle: 'Voice consultations',      icon: Icons.call,      isPerMinute: true,      minValue: 1.00,      maxValue: 8.00,     ),     SizedBox(height: 2.h),     _buildPricingCard(      type: 'video',      title: 'Video Call',      subtitle: 'Face-to-face consultations',      icon: Icons.videocam,      isPerMinute: true,      minValue: 1.50,      maxValue: 10.00,     ),     SizedBox(height: 2.h),     _buildPricingCard(      type: 'report',      title: 'Detailed Report',      subtitle: 'Written analysis and predictions',      icon: Icons.description,      isPerMinute: false,      minValue: 10.00,      maxValue: 200.00,     ),     SizedBox(height: 3.h),     Container(      padding: EdgeInsets.all(3.w),      decoration: BoxDecoration(       color:       Theme.of(context).colorScheme.tertiary.withValues(alpha: 0.1),       borderRadius: BorderRadius.circular(12),       border: Border.all(        color: Theme.of(context)            .colorScheme            .tertiary            .withValues(alpha: 0.3),       ),      ),      child: Row(       children: [        CustomIconWidget(         iconName: 'lightbulb',         size: 5.w,         color: Theme.of(context).colorScheme.tertiary,        ),        SizedBox(width: 3.w),        Expanded(         child: Text(          'Competitive pricing helps attract more clients. You can adjust rates anytime.',          style: Theme.of(context).textTheme.labelSmall?.copyWith(           color: Theme.of(context).colorScheme.tertiary,          ),         ),        ),       ],      ),     ),     SizedBox(height: 2.h),     Row(      children: [       Expanded(        child: Text(         'Total estimated earnings: \$${((_tempPricing['chat'] ?? 0) * 30 + (_tempPricing['audio'] ?? 0) * 20 + (_tempPricing['video'] ?? 0) * 15 + (_tempPricing['report'] ?? 0) * 2).toStringAsFixed(2)}/month',         style: Theme.of(context).textTheme.labelSmall?.copyWith(          color: Theme.of(context).colorScheme.onSurfaceVariant,         ),        ),       ),       SizedBox(width: 3.w),       ElevatedButton(        onPressed: widget.isLoading ? null : widget.onSave,        style: ElevatedButton.styleFrom(         padding:         EdgeInsets.symmetric(horizontal: 6.w, vertical: 1.5.h),         shape: RoundedRectangleBorder(          borderRadius: BorderRadius.circular(8),         ),        ),        child: widget.isLoading            ? SizedBox(         width: 4.w,         height: 4.w,         child: CircularProgressIndicator(          strokeWidth: 2,          valueColor: AlwaysStoppedAnimation<Color>(           Theme.of(context).colorScheme.onPrimary,          ),         ),        )            : Text(         'Save',         style: Theme.of(context).textTheme.labelLarge?.copyWith(          color: Theme.of(context).colorScheme.onPrimary,          fontWeight: FontWeight.w600,         ),        ),       ),      ],     ),    ],   ),  ); }}