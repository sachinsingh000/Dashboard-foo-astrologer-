import 'package:flutter/material.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';class PasswordSection extends StatefulWidget {  final TextEditingController passwordController;  final TextEditingController confirmPasswordController;  final String? passwordError;  final String? confirmPasswordError;  final VoidCallback? onPasswordChanged;  final VoidCallback? onConfirmPasswordChanged;  const PasswordSection({    super.key,    required this.passwordController,    required this.confirmPasswordController,    this.passwordError,    this.confirmPasswordError,    this.onPasswordChanged,    this.onConfirmPasswordChanged,  });  @override  State<PasswordSection> createState() => _PasswordSectionState();}class _PasswordSectionState extends State<PasswordSection> {  bool _isPasswordVisible = false;  bool _isConfirmPasswordVisible = false;  PasswordStrength _getPasswordStrength(String password) {    if (password.isEmpty) return PasswordStrength.none;    int score = 0;    // Length check    if (password.length >= 8) score++;    if (password.length >= 12) score++;    // Character variety checks    if (password.contains(RegExp(r'[a-z]'))) score++;    if (password.contains(RegExp(r'[A-Z]'))) score++;    if (password.contains(RegExp(r'[0-9]'))) score++;    if (password.contains(RegExp(r'[!@#$%^&*(),.?":{}|<>]'))) score++;    if (score <= 2) return PasswordStrength.weak;    if (score <= 4) return PasswordStrength.medium;    return PasswordStrength.strong;  }  @override  Widget build(BuildContext context) {    final theme = Theme.of(context);    final passwordStrength =    _getPasswordStrength(widget.passwordController.text);    return Container(      padding: EdgeInsets.all(4.w),      decoration: BoxDecoration(        color: theme.colorScheme.surface,        borderRadius: BorderRadius.circular(16),        border: Border.all(          color: theme.colorScheme.outline.withValues(alpha: 0.2),          width: 1,        ),      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Account Security',            style: theme.textTheme.titleMedium?.copyWith(              fontWeight: FontWeight.w600,              color: theme.colorScheme.primary,            ),          ),          SizedBox(height: 3.h),          // Password Field          Column(            crossAxisAlignment: CrossAxisAlignment.start,            children: [              Text(                'Password *',                style: theme.textTheme.labelMedium?.copyWith(                  fontWeight: FontWeight.w500,                ),              ),              SizedBox(height: 1.h),              TextFormField(                controller: widget.passwordController,                onChanged: (_) => {                  widget.onPasswordChanged?.call(),                  setState(() {}),                },                obscureText: !_isPasswordVisible,                decoration: InputDecoration(                  hintText: 'Create a strong password',                  prefixIcon: Padding(                    padding: EdgeInsets.all(3.w),                    child: CustomIconWidget(                      iconName: 'lock_outline',                      size: 20,                      color: theme.colorScheme.onSurfaceVariant,                    ),                  ),                  suffixIcon: IconButton(                    icon: CustomIconWidget(                      iconName:                      _isPasswordVisible ? 'visibility_off' : 'visibility',                      size: 20,                      color: theme.colorScheme.onSurfaceVariant,                    ),                    onPressed: () => setState(                            () => _isPasswordVisible = !_isPasswordVisible),                  ),                  errorText: widget.passwordError,                ),                textInputAction: TextInputAction.next,              ),              // Password Strength Indicator              if (widget.passwordController.text.isNotEmpty) ...[                SizedBox(height: 1.h),                _buildPasswordStrengthIndicator(context, passwordStrength),              ],            ],          ),          SizedBox(height: 3.h),          // Confirm Password Field          Column(            crossAxisAlignment: CrossAxisAlignment.start,            children: [              Text(                'Confirm Password *',                style: theme.textTheme.labelMedium?.copyWith(                  fontWeight: FontWeight.w500,                ),              ),              SizedBox(height: 1.h),              TextFormField(                controller: widget.confirmPasswordController,                onChanged: (_) => widget.onConfirmPasswordChanged?.call(),                obscureText: !_isConfirmPasswordVisible,                decoration: InputDecoration(                  hintText: 'Re-enter your password',                  prefixIcon: Padding(                    padding: EdgeInsets.all(3.w),                    child: CustomIconWidget(                      iconName: 'lock_outline',                      size: 20,                      color: theme.colorScheme.onSurfaceVariant,                    ),                  ),                  suffixIcon: IconButton(                    icon: CustomIconWidget(                      iconName: _isConfirmPasswordVisible                          ? 'visibility_off'                          : 'visibility',                      size: 20,                      color: theme.colorScheme.onSurfaceVariant,                    ),                    onPressed: () => setState(() =>                    _isConfirmPasswordVisible = !_isConfirmPasswordVisible),                  ),                  errorText: widget.confirmPasswordError,                ),                textInputAction: TextInputAction.done,              ),            ],          ),          SizedBox(height: 2.h),          // Password Requirements          _buildPasswordRequirements(context),        ],      ),    );  }  Widget _buildPasswordStrengthIndicator(      BuildContext context, PasswordStrength strength) {    final theme = Theme.of(context);    Color getStrengthColor() {      switch (strength) {        case PasswordStrength.weak:          return theme.colorScheme.error;        case PasswordStrength.medium:          return AppTheme.getWarningColor(context);        case PasswordStrength.strong:          return theme.colorScheme.tertiary;        case PasswordStrength.none:          return theme.colorScheme.outline;      }    }    String getStrengthText() {      switch (strength) {        case PasswordStrength.weak:          return 'Weak';        case PasswordStrength.medium:          return 'Medium';        case PasswordStrength.strong:          return 'Strong';        case PasswordStrength.none:          return '';      }    }    double getStrengthProgress() {      switch (strength) {        case PasswordStrength.weak:          return 0.33;        case PasswordStrength.medium:          return 0.66;        case PasswordStrength.strong:          return 1.0;        case PasswordStrength.none:          return 0.0;      }    }    return Column(      crossAxisAlignment: CrossAxisAlignment.start,      children: [        Row(          children: [            Expanded(              child: LinearProgressIndicator(                value: getStrengthProgress(),                backgroundColor:                theme.colorScheme.outline.withValues(alpha: 0.2),                valueColor: AlwaysStoppedAnimation<Color>(getStrengthColor()),                minHeight: 4,              ),            ),            SizedBox(width: 2.w),            Text(              getStrengthText(),              style: theme.textTheme.bodySmall?.copyWith(                color: getStrengthColor(),                fontWeight: FontWeight.w500,              ),            ),          ],        ),      ],    );  }  Widget _buildPasswordRequirements(BuildContext context) {    final theme = Theme.of(context);    final password = widget.passwordController.text;    final requirements = [      {        'text': 'At least 8 characters',        'met': password.length >= 8,      },      {        'text': 'Contains uppercase letter',        'met': password.contains(RegExp(r'[A-Z]')),      },      {        'text': 'Contains lowercase letter',        'met': password.contains(RegExp(r'[a-z]')),      },      {        'text': 'Contains number',        'met': password.contains(RegExp(r'[0-9]')),      },      {        'text': 'Contains special character',        'met': password.contains(RegExp(r'[!@#$%^&*(),.?":{}|<>]')),      },    ];    return Container(      padding: EdgeInsets.all(3.w),      decoration: BoxDecoration(        color: theme.colorScheme.surface,        borderRadius: BorderRadius.circular(8),        border: Border.all(          color: theme.colorScheme.outline.withValues(alpha: 0.2),          width: 1,        ),      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Text(            'Password Requirements:',            style: theme.textTheme.bodySmall?.copyWith(              fontWeight: FontWeight.w500,              color: theme.colorScheme.onSurfaceVariant,            ),          ),          SizedBox(height: 1.h),          ...requirements.map((requirement) {            return Padding(              padding: EdgeInsets.only(bottom: 0.5.h),              child: Row(                children: [                  CustomIconWidget(                    iconName: requirement['met'] as bool                        ? 'check_circle'                        : 'radio_button_unchecked',                    size: 14,                    color: requirement['met'] as bool                        ? theme.colorScheme.tertiary                        : theme.colorScheme.outline,                  ),                  SizedBox(width: 2.w),                  Expanded(                    child: Text(                      requirement['text'] as String,                      style: theme.textTheme.bodySmall?.copyWith(                        color: requirement['met'] as bool                            ? theme.colorScheme.tertiary                            : theme.colorScheme.onSurfaceVariant,                      ),                    ),                  ),                ],              ),            );          }).toList(),        ],      ),    );  }}enum PasswordStrength {  none,  weak,  medium,  strong,}