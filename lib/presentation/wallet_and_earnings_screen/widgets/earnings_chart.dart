import 'package:fl_chart/fl_chart.dart';import 'package:flutter/material.dart';import 'package:sizer/sizer.dart';import '../../../core/app_export.dart';import '../../../theme/app_theme.dart';class EarningsChart extends StatefulWidget {  final List<Map<String, dynamic>> chartData;  final String selectedPeriod;  final Function(String) onPeriodChanged;  const EarningsChart({    super.key,    required this.chartData,    required this.selectedPeriod,    required this.onPeriodChanged,  });  @override  State<EarningsChart> createState() => _EarningsChartState();}class _EarningsChartState extends State<EarningsChart> {  int touchedIndex = -1;  @override  Widget build(BuildContext context) {    final theme = Theme.of(context);    return Container(      margin: EdgeInsets.symmetric(horizontal: 4.w),      padding: EdgeInsets.all(4.w),      decoration: BoxDecoration(        color: theme.colorScheme.surface,        borderRadius: BorderRadius.circular(16),        border: Border.all(          color: theme.colorScheme.outline.withValues(alpha: 0.1),          width: 1,        ),      ),      child: Column(        crossAxisAlignment: CrossAxisAlignment.start,        children: [          Row(            mainAxisAlignment: MainAxisAlignment.spaceBetween,            children: [              Text(                'Earnings Trend',                style: theme.textTheme.titleMedium?.copyWith(                  fontWeight: FontWeight.w600,                ),              ),              _buildPeriodSelector(context),            ],          ),          SizedBox(height: 3.h),          SizedBox(            height: 25.h,            child: Semantics(              label:              "Earnings trend chart showing ${widget.selectedPeriod} data",              child: LineChart(                LineChartData(                  gridData: FlGridData(                    show: true,                    drawVerticalLine: false,                    horizontalInterval: 500,                    getDrawingHorizontalLine: (value) {                      return FlLine(                        color: theme.colorScheme.outline.withValues(alpha: 0.1),                        strokeWidth: 1,                      );                    },                  ),                  titlesData: FlTitlesData(                    show: true,                    rightTitles: const AxisTitles(                      sideTitles: SideTitles(showTitles: false),                    ),                    topTitles: const AxisTitles(                      sideTitles: SideTitles(showTitles: false),                    ),                    bottomTitles: AxisTitles(                      sideTitles: SideTitles(                        showTitles: true,                        reservedSize: 30,                        interval: 1,                        getTitlesWidget: (double value, TitleMeta meta) {                          return _buildBottomTitle(value.toInt(), theme);                        },                      ),                    ),                    leftTitles: AxisTitles(                      sideTitles: SideTitles(                        showTitles: true,                        interval: 500,                        getTitlesWidget: (double value, TitleMeta meta) {                          return Text(                            '\$${(value / 1000).toStringAsFixed(0)}k',                            style: theme.textTheme.labelSmall?.copyWith(                              color: theme.colorScheme.onSurfaceVariant,                            ),                          );                        },                        reservedSize: 42,                      ),                    ),                  ),                  borderData: FlBorderData(                    show: true,                    border: Border.all(                      color: theme.colorScheme.outline.withValues(alpha: 0.1),                    ),                  ),                  minX: 0,                  maxX: (widget.chartData.length - 1).toDouble(),                  minY: 0,                  maxY: _getMaxY(),                  lineBarsData: [                    LineChartBarData(                      spots: _getSpots(),                      isCurved: true,                      gradient: LinearGradient(                        colors: [                          theme.colorScheme.primary,                          theme.colorScheme.secondary,                        ],                      ),                      barWidth: 3,                      isStrokeCapRound: true,                      dotData: FlDotData(                        show: true,                        getDotPainter: (spot, percent, barData, index) {                          return FlDotCirclePainter(                            radius: 4,                            color: theme.colorScheme.primary,                            strokeWidth: 2,                            strokeColor: theme.colorScheme.surface,                          );                        },                      ),                      belowBarData: BarAreaData(                        show: true,                        gradient: LinearGradient(                          colors: [                            theme.colorScheme.primary.withValues(alpha: 0.3),                            theme.colorScheme.primary.withValues(alpha: 0.1),                          ],                          begin: Alignment.topCenter,                          end: Alignment.bottomCenter,                        ),                      ),                    ),                  ],                  lineTouchData: LineTouchData(                    enabled: true,                    touchTooltipData: LineTouchTooltipData(                      tooltipBgColor: theme.colorScheme.inverseSurface,                      tooltipRoundedRadius: 8,                      getTooltipItems: (List<LineBarSpot> touchedBarSpots) {                        return touchedBarSpots.map((barSpot) {                          final flSpot = barSpot;                          return LineTooltipItem(                            '\${flSpot.y.toStringAsFixed(0)}',                            TextStyle(                              color: theme.colorScheme.onInverseSurface,                              fontWeight: FontWeight.bold,                            ),                          );                        }).toList();                      },                    ),                  ),                ),              ),            ),          ),          SizedBox(height: 2.h),          _buildChartLegend(context),        ],      ),    );  }  Widget _buildPeriodSelector(BuildContext context) {    final theme = Theme.of(context);    final periods = ['7D', '1M', '3M', '1Y'];    return Container(      padding: EdgeInsets.all(1.w),      decoration: BoxDecoration(        color: AppTheme.getAccentColor(context),        borderRadius: BorderRadius.circular(8),      ),      child: Row(        mainAxisSize: MainAxisSize.min,        children: periods.map((period) {          final isSelected = period == widget.selectedPeriod;          return GestureDetector(            onTap: () => widget.onPeriodChanged(period),            child: Container(              padding: EdgeInsets.symmetric(horizontal: 3.w, vertical: 1.h),              decoration: BoxDecoration(                color:                isSelected ? theme.colorScheme.primary : Colors.transparent,                borderRadius: BorderRadius.circular(6),              ),              child: Text(                period,                style: theme.textTheme.labelSmall?.copyWith(                  color: isSelected                      ? theme.colorScheme.onPrimary                      : theme.colorScheme.onSurfaceVariant,                  fontWeight: FontWeight.w600,                ),              ),            ),          );        }).toList(),      ),    );  }  Widget _buildBottomTitle(int value, ThemeData theme) {    if (value < 0 || value >= widget.chartData.length) {      return const SizedBox.shrink();    }    final data = widget.chartData[value];    final label = data['label'] as String;    return Padding(      padding: EdgeInsets.only(top: 1.h),      child: Text(        label,        style: theme.textTheme.labelSmall?.copyWith(          color: theme.colorScheme.onSurfaceVariant,        ),      ),    );  }  Widget _buildChartLegend(BuildContext context) {    final theme = Theme.of(context);    return Row(      mainAxisAlignment: MainAxisAlignment.center,      children: [        Container(          width: 12,          height: 12,          decoration: BoxDecoration(            color: theme.colorScheme.primary,            borderRadius: BorderRadius.circular(2),          ),        ),        SizedBox(width: 2.w),        Text(          'Total Earnings',          style: theme.textTheme.labelSmall?.copyWith(            color: theme.colorScheme.onSurfaceVariant,          ),        ),      ],    );  }  List<FlSpot> _getSpots() {    return widget.chartData.asMap().entries.map((entry) {      final index = entry.key;      final data = entry.value;      final value = (data['value'] as num).toDouble();      return FlSpot(index.toDouble(), value);    }).toList();  }  double _getMaxY() {    if (widget.chartData.isEmpty) return 1000;    final maxValue = widget.chartData        .map((data) => (data['value'] as num).toDouble())        .reduce((a, b) => a > b ? a : b);    return (maxValue * 1.2).ceilToDouble();  }}