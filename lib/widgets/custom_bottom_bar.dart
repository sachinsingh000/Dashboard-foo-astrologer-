import 'package:flutter/material.dart';/// Custom Bottom Navigation Bar for the astrology consultation application/// Provides contextual navigation that adapts during active sessionsclass CustomBottomBar extends StatefulWidget {  /// Current selected index  final int currentIndex;  /// Callback when tab is selected  final ValueChanged<int> onTap;  /// Whether the user is currently in an active consultation session  final bool isInActiveSession;  /// Type of bottom bar variant  final CustomBottomBarVariant variant;  /// Whether to show labels on navigation items  final bool showLabels;  /// Custom background color  final Color? backgroundColor;  /// Custom selected item color  final Color? selectedItemColor;  /// Custom unselected item color  final Color? unselectedItemColor;  const CustomBottomBar({    super.key,    required this.currentIndex,    required this.onTap,    this.isInActiveSession = false,    this.variant = CustomBottomBarVariant.standard,    this.showLabels = true,    this.backgroundColor,    this.selectedItemColor,    this.unselectedItemColor,  });  /// Standard bottom bar for main navigation  const CustomBottomBar.standard({    super.key,    required this.currentIndex,    required this.onTap,  })  : isInActiveSession = false,        variant = CustomBottomBarVariant.standard,        showLabels = true,        backgroundColor = null,        selectedItemColor = null,        unselectedItemColor = null;  /// Session bottom bar for active consultations  const CustomBottomBar.session({    super.key,    required this.currentIndex,    required this.onTap,  })  : isInActiveSession = true,        variant = CustomBottomBarVariant.session,        showLabels = false,        backgroundColor = null,        selectedItemColor = null,        unselectedItemColor = null;  /// Minimal bottom bar with essential navigation only  const CustomBottomBar.minimal({    super.key,    required this.currentIndex,    required this.onTap,  })  : isInActiveSession = false,        variant = CustomBottomBarVariant.minimal,        showLabels = false,        backgroundColor = null,        selectedItemColor = null,        unselectedItemColor = null;  @override  State<CustomBottomBar> createState() => _CustomBottomBarState();}class _CustomBottomBarState extends State<CustomBottomBar>    with TickerProviderStateMixin {  late AnimationController _animationController;  late Animation<double> _scaleAnimation;  @override  void initState() {    super.initState();    _animationController = AnimationController(      duration: const Duration(milliseconds: 200),      vsync: this,    );    _scaleAnimation = Tween<double>(      begin: 1.0,      end: 0.95,    ).animate(CurvedAnimation(      parent: _animationController,      curve: Curves.easeInOut,    ));  }  @override  void dispose() {    _animationController.dispose();    super.dispose();  }  @override  Widget build(BuildContext context) {    final theme = Theme.of(context);    return AnimatedContainer(      duration: const Duration(milliseconds: 300),      curve: Curves.easeInOut,      decoration: BoxDecoration(        color: widget.backgroundColor ??            theme.bottomNavigationBarTheme.backgroundColor,        boxShadow: [          BoxShadow(            color: theme.shadowColor.withAlpha(26),            blurRadius: 8,            offset: const Offset(0, -2),          ),        ],      ),      child: SafeArea(        child: Container(          height: _getBottomBarHeight(),          padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),          child: _buildBottomBarContent(context),        ),      ),    );  }  double _getBottomBarHeight() {    switch (widget.variant) {      case CustomBottomBarVariant.session:        return 80;      case CustomBottomBarVariant.minimal:        return 60;      default:        return widget.showLabels ? 80 : 60;    }  }  Widget _buildBottomBarContent(BuildContext context) {    switch (widget.variant) {      case CustomBottomBarVariant.session:        return _buildSessionBottomBar(context);      case CustomBottomBarVariant.minimal:        return _buildMinimalBottomBar(context);      default:        return _buildStandardBottomBar(context);    }  }  Widget _buildStandardBottomBar(BuildContext context) {    final items = _getStandardNavigationItems();    return Row(      mainAxisAlignment: MainAxisAlignment.spaceAround,      children: items.asMap().entries.map((entry) {        final index = entry.key;        final item = entry.value;        final isSelected = index == widget.currentIndex;        return Expanded(          child: _buildNavigationItem(            context: context,            item: item,            isSelected: isSelected,            onTap: () => _handleTap(index, item.route),          ),        );      }).toList(),    );  }  Widget _buildSessionBottomBar(BuildContext context) {    final theme = Theme.of(context);    return Row(      mainAxisAlignment: MainAxisAlignment.spaceEvenly,      children: [        _buildSessionAction(          context: context,          icon: Icons.mic_off,          label: 'Mute',          onTap: () => _handleSessionAction('mute'),        ),        _buildSessionAction(          context: context,          icon: Icons.videocam_off,          label: 'Video',          onTap: () => _handleSessionAction('video'),        ),        Container(          width: 60,          height: 60,          decoration: BoxDecoration(            color: theme.colorScheme.error,            shape: BoxShape.circle,          ),          child: IconButton(            icon: const Icon(Icons.call_end, color: Colors.white),            onPressed: () => _handleSessionAction('end'),          ),        ),        _buildSessionAction(          context: context,          icon: Icons.chat,          label: 'Chat',          onTap: () => Navigator.pushNamed(context, '/chat-interface-screen'),        ),        _buildSessionAction(          context: context,          icon: Icons.more_horiz,          label: 'More',          onTap: () => _showSessionMenu(context),        ),      ],    );  }  Widget _buildMinimalBottomBar(BuildContext context) {    return Row(      mainAxisAlignment: MainAxisAlignment.spaceEvenly,      children: [        _buildMinimalItem(          context: context,          icon: Icons.home_outlined,          selectedIcon: Icons.home,          isSelected: widget.currentIndex == 0,          onTap: () => _handleTap(0, '/dashboard-screen'),        ),        _buildMinimalItem(          context: context,          icon: Icons.calendar_today_outlined,          selectedIcon: Icons.calendar_today,          isSelected: widget.currentIndex == 1,          onTap: () => _handleTap(1, '/consultation-requests-screen'),        ),        _buildMinimalItem(          context: context,          icon: Icons.account_balance_wallet_outlined,          selectedIcon: Icons.account_balance_wallet,          isSelected: widget.currentIndex == 2,          onTap: () => _handleTap(2, '/wallet-and-earnings-screen'),        ),        _buildMinimalItem(          context: context,          icon: Icons.person_outline,          selectedIcon: Icons.person,          isSelected: widget.currentIndex == 3,          onTap: () => _handleTap(3, '/profile-management-screen'),        ),      ],    );  }  Widget _buildNavigationItem({    required BuildContext context,    required BottomNavigationItem item,    required bool isSelected,    required VoidCallback onTap,  }) {    final theme = Theme.of(context);    final selectedColor = widget.selectedItemColor ??        theme.bottomNavigationBarTheme.selectedItemColor;    final unselectedColor = widget.unselectedItemColor ??        theme.bottomNavigationBarTheme.unselectedItemColor;    return GestureDetector(      onTap: onTap,      onTapDown: (_) => _animationController.forward(),      onTapUp: (_) => _animationController.reverse(),      onTapCancel: () => _animationController.reverse(),      child: AnimatedBuilder(        animation: _scaleAnimation,        builder: (context, child) {          return Transform.scale(            scale: isSelected ? _scaleAnimation.value : 1.0,            child: Container(              padding: const EdgeInsets.symmetric(vertical: 8),              child: Column(                mainAxisSize: MainAxisSize.min,                children: [                  AnimatedContainer(                    duration: const Duration(milliseconds: 200),                    padding: const EdgeInsets.all(8),                    decoration: BoxDecoration(                      color: isSelected                          ? selectedColor?.withAlpha(26)                          : Colors.transparent,                      borderRadius: BorderRadius.circular(12),                    ),                    child: Icon(                      isSelected ? item.selectedIcon : item.icon,                      color: isSelected ? selectedColor : unselectedColor,                      size: 24,                    ),                  ),                  if (widget.showLabels) ...[                    const SizedBox(height: 4),                    AnimatedDefaultTextStyle(                      duration: const Duration(milliseconds: 200),                      style: theme.textTheme.labelSmall!.copyWith(                        color: isSelected ? selectedColor : unselectedColor,                        fontWeight:                        isSelected ? FontWeight.w600 : FontWeight.w400,                      ),                      child: Text(item.label),                    ),                  ],                ],              ),            ),          );        },      ),    );  }  Widget _buildSessionAction({    required BuildContext context,    required IconData icon,    required String label,    required VoidCallback onTap,  }) {    final theme = Theme.of(context);    return GestureDetector(      onTap: onTap,      child: Column(        mainAxisSize: MainAxisSize.min,        children: [          Container(            width: 48,            height: 48,            decoration: BoxDecoration(              color: theme.colorScheme.surface,              shape: BoxShape.circle,              border: Border.all(                color: theme.colorScheme.outline,                width: 1,              ),            ),            child: Icon(              icon,              color: theme.colorScheme.onSurface,              size: 20,            ),          ),          const SizedBox(height: 4),          Text(            label,            style: theme.textTheme.labelSmall,          ),        ],      ),    );  }  Widget _buildMinimalItem({    required BuildContext context,    required IconData icon,    required IconData selectedIcon,    required bool isSelected,    required VoidCallback onTap,  }) {    final theme = Theme.of(context);    final selectedColor = widget.selectedItemColor ??        theme.bottomNavigationBarTheme.selectedItemColor;    final unselectedColor = widget.unselectedItemColor ??        theme.bottomNavigationBarTheme.unselectedItemColor;    return GestureDetector(      onTap: onTap,      child: AnimatedContainer(        duration: const Duration(milliseconds: 200),        padding: const EdgeInsets.all(12),        decoration: BoxDecoration(          color: isSelected ? selectedColor?.withAlpha(26) : Colors.transparent,          borderRadius: BorderRadius.circular(16),        ),        child: Icon(          isSelected ? selectedIcon : icon,          color: isSelected ? selectedColor : unselectedColor,          size: 24,        ),      ),    );  }  List<BottomNavigationItem> _getStandardNavigationItems() {    return [      BottomNavigationItem(        icon: Icons.home_outlined,        selectedIcon: Icons.home,        label: 'Dashboard',        route: '/dashboard-screen',      ),      BottomNavigationItem(        icon: Icons.calendar_today_outlined,        selectedIcon: Icons.calendar_today,        label: 'Requests',        route: '/consultation-requests-screen',      ),      BottomNavigationItem(        icon: Icons.chat_outlined,        selectedIcon: Icons.chat,        label: 'Chats',        route: '/chat-interface-screen',      ),      BottomNavigationItem(        icon: Icons.account_balance_wallet_outlined,        selectedIcon: Icons.account_balance_wallet,        label: 'Earnings',        route: '/wallet-and-earnings-screen',      ),      BottomNavigationItem(        icon: Icons.person_outline,        selectedIcon: Icons.person,        label: 'Profile',        route: '/profile-management-screen',      ),    ];  }  void _handleTap(int index, String route) {    if (index != widget.currentIndex) {      widget.onTap(index);      Navigator.pushNamed(context, route);    }  }  void _handleSessionAction(String action) {    switch (action) {      case 'mute':      // Handle mute toggle        break;      case 'video':      // Handle video toggle        break;      case 'end':      // Handle session end        Navigator.pushNamedAndRemoveUntil(          context,          '/dashboard-screen',              (route) => false,        );        break;    }  }  void _showSessionMenu(BuildContext context) {    showModalBottomSheet(      context: context,      builder: (context) => Container(        padding: const EdgeInsets.all(16),        child: Column(          mainAxisSize: MainAxisSize.min,          children: [            ListTile(              leading: const Icon(Icons.description),              title: const Text('Generate Report'),              onTap: () {                Navigator.pop(context);                Navigator.pushNamed(context, '/report-editor-screen');              },            ),            ListTile(              leading: const Icon(Icons.schedule),              title: const Text('Extend Session'),              onTap: () {                Navigator.pop(context);                // Handle session extension              },            ),            ListTile(              leading: const Icon(Icons.feedback),              title: const Text('Session Feedback'),              onTap: () {                Navigator.pop(context);                // Handle feedback              },            ),          ],        ),      ),    );  }}/// Enum defining different bottom bar variantsenum CustomBottomBarVariant {  /// Standard bottom bar for main navigation  standard,  /// Session bottom bar for active consultations  session,  /// Minimal bottom bar with essential navigation only  minimal,}/// Data class for bottom navigation itemsclass BottomNavigationItem {  final IconData icon;  final IconData selectedIcon;  final String label;  final String route;  const BottomNavigationItem({    required this.icon,    required this.selectedIcon,    required this.label,    required this.route,  });}